<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">



























  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">











 
 
 <link href="/lib/font-awesome/css/font-awesome.css?v=4.6.2" rel="stylesheet" type="text/css"> 



<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"perspectiveLeftIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="概述MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，目前属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件。MySQL是一种关系数据库管理系统，关系数据库将数据保存在不同的表中，而不是将">
<meta name="keywords" content="事务,mysql,优化,sql,主从配置,索引,存储引擎">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL详解&amp;优化记录">
<meta property="og:url" content="http://yangzhiwen911.github.io/2019/02/14/Mysql优化记录/index.html">
<meta property="og:site_name" content="未知世界的秘密">
<meta property="og:description" content="概述MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，目前属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件。MySQL是一种关系数据库管理系统，关系数据库将数据保存在不同的表中，而不是将">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yangzhiwen911.github.io/images/pasted-51.png">
<meta property="og:image" content="http://yangzhiwen911.github.io/images/pasted-44.png">
<meta property="og:image" content="http://yangzhiwen911.github.io/images/pasted-50.png">
<meta property="og:image" content="http://yangzhiwen911.github.io/images/pasted-45.png">
<meta property="og:image" content="http://yangzhiwen911.github.io/images/pasted-52.png">
<meta property="og:image" content="http://yangzhiwen911.github.io/images/pasted-49.png">
<meta property="og:image" content="http://yangzhiwen911.github.io/images/pasted-46.png">
<meta property="og:image" content="http://yangzhiwen911.github.io/images/pasted-47.png">
<meta property="og:image" content="http://yangzhiwen911.github.io/images/pasted-48.png">
<meta property="og:updated_time" content="2019-02-24T05:58:27.918Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL详解&amp;优化记录">
<meta name="twitter:description" content="概述MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，目前属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件。MySQL是一种关系数据库管理系统，关系数据库将数据保存在不同的表中，而不是将">
<meta name="twitter:image" content="http://yangzhiwen911.github.io/images/pasted-51.png">



  <link rel="alternate" href="/atom.xml" title="未知世界的秘密" type="application/atom+xml">




  <link rel="canonical" href="http://yangzhiwen911.github.io/2019/02/14/Mysql优化记录/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>MySQL详解&优化记录 | 未知世界的秘密</title>
  












  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	<!--
	<a href="https://github.com/yangzhiwen911"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png" alt="Fork me on GitHub"></a>
    -->
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">未知世界的秘密</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">做一个有梦想的咸鱼</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>站点地图</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-document">

    
    
    
      
    

    

    <a href="/doc/" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i> <br>开发手册</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yangzhiwen911.github.io/2019/02/14/Mysql优化记录/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="志文">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/jackie.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="未知世界的秘密">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">MySQL详解&优化记录

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

             2019-02-14

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
               2019-02-24
            
          </span>
		  
		  
		  
		  
		  
		  &nbsp; | &nbsp;  <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
				<span class="post-meta-item-text"> 
				10.6k	字			 
				</span>
		  
		  
		
			
		  
		  
		  
		  

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a></span>

                
                
              
            </span>
          
		  
		  
		    
		  
		  
		  
		  
		 
		  
		  
			&nbsp; | &nbsp;  <span class="post-meta-item-icon">
                  <i class="fa fa-user"></i>
                </span><span class="post-meta-item-text"> 作者
				 Jakcie.Yang
				</span>
		
		  
		   

          
            
          

          
          

          

          

          
		    
		  
		  
		  
		
		 
        <div class="post-tags">
		 
          
            <a href="/tags/事务/" rel="tag"><i class="fa fa-tag"></i> 事务</a>
          
            <a href="/tags/mysql/" rel="tag"><i class="fa fa-tag"></i> mysql</a>
          
            <a href="/tags/优化/" rel="tag"><i class="fa fa-tag"></i> 优化</a>
          
            <a href="/tags/sql/" rel="tag"><i class="fa fa-tag"></i> sql</a>
          
            <a href="/tags/主从配置/" rel="tag"><i class="fa fa-tag"></i> 主从配置</a>
          
            <a href="/tags/索引/" rel="tag"><i class="fa fa-tag"></i> 索引</a>
          
            <a href="/tags/存储引擎/" rel="tag"><i class="fa fa-tag"></i> 存储引擎</a>
          
        </div>
      

        </div>
		
				
				
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><code>MySQL</code>是一个关系型<code>数据库管理系统</code>，由瑞典MySQL AB 公司开发，目前属于 Oracle 旗下产品。<code>MySQL</code> 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，<code>MySQL</code>是最好的 <code>RDBMS</code> (Relational Database Management System，关系数据库管理系统) 应用软件。<br>MySQL是一种关系数据库管理系统，关系数据库将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样就增加了速度并提高了灵活性。<br>MySQL所使用的 SQL 语言是用于访问数据库的最常用标准化语言。MySQL 软件采用了双授权政策，分为社区版和商业版，由于其体积小、速度快、总体拥有成本低，尤其是开放源码这一特点，一般中小型网站的开发都选择 MySQL 作为网站数据库。</p>
<a id="more"></a>
<h3 id="新特性"><a href="#新特性" class="headerlink" title="新特性"></a>新特性</h3><ul>
<li>表和索引的分区</li>
<li>行级复制</li>
<li>MySQL 基群基于磁盘的数据支持</li>
<li>MySQL 集群复制</li>
<li>增强的全文本搜索函数</li>
<li>增强的信息模式(数据字典)</li>
<li>可插入的 API</li>
<li>服务器日志表</li>
<li>XML（标准通用标记语言的子集）/ XPath支持</li>
<li>实例管理器</li>
<li>表空间备份</li>
<li>mysql_upgrade 升级程序</li>
<li>内部任务/事件调度器</li>
<li>新的性能工具和选项如 mysqlslap</li>
</ul>
<h3 id="DBMS"><a href="#DBMS" class="headerlink" title="DBMS"></a>DBMS</h3><p><strong>数据库管理系统(DataBase Manage System)。</strong></p>
<ul>
<li><p>DQL</p>
<ul>
<li>数据查询语言（Data Query Language, DQL）是SQL语言中，负责进行数据查询而不会对数据本身进行修改的语句，这是最基本的SQL语句。</li>
</ul>
</li>
<li><p>DDL</p>
<ul>
<li>数据定义语言（Data Definition Language，DDL）是SQL语言集中负责数据结构定义与数据库对象定义的语言，由CREATE、ALTER与DROP三个语法所组成，最早是由Codasyl（Conference on Data Systems Languages）数据模型开始，现在被纳入SQL指令中作为其中一个子集。</li>
</ul>
</li>
<li><p>DML</p>
<ul>
<li>数据操纵语言（Data Manipulation Language, DML）欧美地区的开发人员把这四种指令，以“CRUD”(分别为 Create, Read, Update, Delete英文四前缀字母缩略的术语)来称呼；而亚洲地区使用汉语的开发人员，或可能以四个汉字：增 查 改 删 来略称。</li>
</ul>
</li>
<li><p>DCL</p>
<ul>
<li>数据控制语言 (Data Control Language) 在SQL语言中，是一种可对数据访问权进行控制的指令，它可以控制特定用户账户对数据表、查看表、预存程序、用户自定义函数等数据库对象的控制权。由 GRANT 和 REVOKE 两个指令组成。</li>
</ul>
</li>
</ul>
<h3 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h3><p><code>MVCC</code> 是一种多版本并发控制机制，是通过保存数据在某个时间点的快照来实现的. 不同存储引擎的<code>MVCC</code>. 不同存储引擎的MVCC实现是不同的,典型的有乐观并发控制和悲观并发控制。</p>
<ul>
<li>大多数的MYSQL事务型存储引擎,如InnoDB，Falcon以及PBXT都不使用一种简单的行锁机制.事实上,他们都和<code>MVCC</code>–多版本并发控制来一起使用.</li>
<li>众所周知,锁机制可以控制并发操作,但是其系统开销较大,而MVCC可以在大多数情况下代替行级锁,使用<code>MVCC</code>,能降低其系统开销.</li>
</ul>
<h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h3><ul>
<li><p>事务是数据库系统区别于其他一切文件系统的重要特性之一</p>
</li>
<li><p>事务是一组具有原子性的SQL语句，或者一个独立的工作单元</p>
</li>
</ul>
<p>mysql默认的事务隔离级别为 <code>repeatable-read</code>，可以使用如下命令查询：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @@tx_isolation;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><h4 id="事务的基本要素（ACID）"><a href="#事务的基本要素（ACID）" class="headerlink" title="事务的基本要素（ACID）"></a>事务的基本要素（ACID）</h4></li>
<li><p>1、原子性（Atomicity）：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。</p>
</li>
<li><p>2、一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。</p>
</li>
<li><p>3、隔离性（Isolation）：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。</p>
</li>
<li><p>4、持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。</p>
</li>
<li><h4 id="事务的并发问题"><a href="#事务的并发问题" class="headerlink" title="事务的并发问题"></a>事务的并发问题</h4></li>
<li><p>1、脏读：<code>未提交读(READ UNCOMMITED)</code>，事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据。</p>
</li>
<li><p>2、不可重复读：<code>已提交读(READ COMMITED)</code>符合隔离性的基本概念，事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果 不一致。</p>
</li>
<li><p>3、可重复读：<code>(REPEATABLE READ) InnoDB的默认隔离等级</code>。事务进行时，其它所有事务对其不可见，即多次执行读，得到的结果是一样的！</p>
</li>
<li><p>4、幻读：系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读。</p>
</li>
</ul>
<p><code>小结：不可重复读的和幻读很容易混淆，不可重复读侧重于修改，幻读侧重于新增或删除。解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表。</code></p>
<ul>
<li><h4 id="事务隔离级别-1"><a href="#事务隔离级别-1" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h4></li>
</ul>
<table>
<thead>
<tr>
<th>事务隔离级别</th>
<th style="text-align:center">脏读</th>
<th style="text-align:center">不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td>读未提交（read-uncommitted）</td>
<td style="text-align:center">是</td>
<td style="text-align:center">是</td>
<td>是</td>
</tr>
<tr>
<td>不可重复读（read-committed）</td>
<td style="text-align:center">否</td>
<td style="text-align:center">是</td>
<td>是</td>
</tr>
<tr>
<td>可重复读（repeatable-read）</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td>是</td>
</tr>
<tr>
<td>串行化（serializable）</td>
<td style="text-align:center">否</td>
<td style="text-align:center">否</td>
<td>否</td>
</tr>
</tbody>
</table>
<h3 id="数据库锁"><a href="#数据库锁" class="headerlink" title="数据库锁"></a>数据库锁</h3><p><code>MySQL</code>中锁主要作用是针对共享资源的并发访问以及用于实现事务的隔离性。</p>
<p><strong><code>MySQL</code>数据中常见的锁解读</strong></p>
<ul>
<li><h4 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h4><p>乐观并发控制（又名“乐观锁”，Optimistic Concurrency Control，缩写“OCC”）是一种并发控制的方法。它假设多用户并发的事务在处理时不会彼此互相影响，各事务能够在不产生锁的情况下处理各自影响的那部分数据。在提交数据更新之前，每个事务会先检查在该事务读取数据后，有没有其他事务又修改了该数据。如果其他事务有更新的话，正在提交的事务会进行回滚。乐观事务控制最早是由孔祥重（H.T.Kung）教授提出。</p>
</li>
</ul>
<p>乐观并发控制多数用于数据争用不大、冲突较少的环境中，这种环境中，偶尔回滚事务的成本会低于读取数据时锁定数据的成本，因此可以获得比其他并发控制方法更高的吞吐量。</p>
<p>  <strong>优缺点：</strong></p>
<p>  <code>乐观并发控制相信事务之间的数据竞争(data race)的概率是比较小的，因此尽可能直接做下去，直到提交的时候才去锁定，所以不会产生任何锁和死锁。但如果直接简单这么做，还是有可能会遇到不可预期的结果，例如两个事务都读取了数据库的某一行，经过修改以后写回数据库，这时就遇到了问题。</code></p>
<ul>
<li><h4 id="悲观锁"><a href="#悲观锁" class="headerlink" title="悲观锁"></a>悲观锁</h4></li>
</ul>
<p>悲观并发控制（又名“悲观锁”，Pessimistic Concurrency Control，缩写“PCC”）是一种并发控制的方法。它可以阻止一个事务以影响其他用户的方式来修改数据。如果一个事务执行的操作读某行数据应用了锁，那只有当这个事务把锁释放，其他事务才能够执行与该锁冲突的操作。</p>
<p>悲观并发控制主要用于数据争用激烈的环境，以及发生并发冲突时使用锁保护数据的成本要低于回滚事务的成本的环境中。</p>
<p> <strong>按使用性质划分</strong></p>
<ul>
<li><h4 id="共享锁（Share-Lock）"><a href="#共享锁（Share-Lock）" class="headerlink" title="共享锁（Share Lock）"></a>共享锁（Share Lock）</h4><ul>
<li>S锁，也叫读锁，用于所有的只读数据操作。共享锁是非独占的，允许多个并发事务读取其锁定的资源。 </li>
</ul>
<ol>
<li>多个事务可封锁同一个共享页； </li>
<li>任何事务都不能修改该页； </li>
<li>通常是该页被读取完毕，S锁立即被释放。</li>
</ol>
</li>
<li><h4 id="更新锁（Update-Lock）"><a href="#更新锁（Update-Lock）" class="headerlink" title="更新锁（Update Lock）"></a>更新锁（Update Lock）</h4><ul>
<li>U锁，在修改操作的初始化阶段用来锁定可能要被修改的资源，这样可以避免使用共享锁造成的死锁现象。<br>因为当使用共享锁时，修改数据的操作分为两步： </li>
<li>首先获得一个共享锁，读取数据，然后将共享锁升级为排他锁，再执行修改操作。 </li>
<li>这样如果有两个或多个事务同时对一个事务申请了共享锁，在修改数据时，这些事务都要将共享锁升级为排    他锁。这时，这些事务都不会释放共享锁，而是一直等待对方释放，这样就造成了死锁。 </li>
<li>如果一个数据在修改前直接申请更新锁，在数据修改时再升级为排他锁，就可以避免死锁。</li>
</ul>
</li>
<li><h4 id="排他锁（Exclusive-Lock）"><a href="#排他锁（Exclusive-Lock）" class="headerlink" title="排他锁（Exclusive Lock）"></a>排他锁（Exclusive Lock）</h4><ul>
<li>X锁，也叫写锁，表示对数据进行写操作。如果一个事务对对象加了排他锁，其他事务就不能再给它加任何锁了。（某个顾客把试衣间从里面反锁了，其他顾客想要使用这个试衣间，就只有等待锁从里面打开了。） </li>
</ul>
</li>
</ul>
<p> <strong>按作用范围划分 </strong></p>
<ul>
<li><h4 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h4><ul>
<li>锁的作用范围是行级别。</li>
</ul>
</li>
<li><h4 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h4><ul>
<li>锁的作用范围是整张表。数据库能够确定那些行需要锁的情况下使用行锁，如果不知道会影响哪些行的时候就会使用表锁。</li>
</ul>
</li>
<li><h4 id="页锁"><a href="#页锁" class="headerlink" title="页锁"></a>页锁</h4><ul>
<li>对表中一组连续的行进行加锁。</li>
</ul>
</li>
<li><p>性能比较</p>
<ul>
<li>表锁：开销小，加锁快；不会出现死锁；锁定力度大，发生锁冲突概率高，并发度最低</li>
<li>行锁：开销大，加锁慢；会出现死锁；锁定粒度小，发生锁冲突的概率低，并发度高</li>
<li>页锁：开销和加锁速度介于表锁和行锁之间；会出现死锁；锁定粒度介于表锁和行锁之间，并发度一般</li>
</ul>
</li>
</ul>
<p> <strong>优缺点：</strong></p>
<p> <code>悲观并发控制实际上是“先取锁再访问”的保守策略，为数据处理的安全提供了保证。但是在效率方面，处理加锁的机制会让数据库产生额外的开销，还有增加产生死锁的机会；另外，在只读型事务处理中由于不会产生冲突，也没必要使用锁，这样做只能增加系统负载；还有会降低了并行性，一个事务如果锁定了某行数据，其他事务就必须等待该事务处理完才可以处理那行数据。</code></p>
<h3 id="MySQL性能"><a href="#MySQL性能" class="headerlink" title="MySQL性能"></a>MySQL性能</h3><p><strong>影响<code>MySQL</code>性能的几个因素：</strong></p>
<blockquote><p>QPS：Queries Per Second意思是“每秒查询率”，是一台服务器每秒能够相应的查询次数。</p>
</blockquote>
<blockquote><p>TPS：是TransactionsPerSecond的缩写，也就是事务数/秒。它是软件测试结果的测量单位。</p>
</blockquote>
<ul>
<li>服务器硬件</li>
<li>服务器系统（系统参数优化）</li>
<li>磁盘IO<ul>
<li>磁盘IO性能突然下降、大量消耗磁盘性能的计划任务。解决：更快磁盘设备、调整计划任务、做好磁盘维护。</li>
</ul>
</li>
<li>网络延迟</li>
<li>存储引擎。<ul>
<li>MyISAM： 不支持事务，表级锁。</li>
<li>InnoDB: 支持事务，支持行级锁，事务ACID。</li>
</ul>
</li>
<li>数据库参数配置</li>
<li>数据库结构设计和SQL语句。（重点优化）</li>
</ul>
<h3 id="默认库解读"><a href="#默认库解读" class="headerlink" title="默认库解读"></a>默认库解读</h3><ul>
<li><p>information_schema</p>
<ul>
<li><p>information_schema提供了访问数据库元数据的方式。(元数据是关于数据的数据，如数据库名或表名，列的数据类型，或访问权限等。有时用于表述该信息的其他术语包括“数据词典”和“系统目录”。) </p>
</li>
<li><p>换句换说，information_schema是一个信息数据库，它保存着关于MySQL服务器所维护的所有其他数据库的信息。(如数据库名，数据库的表，表栏的数据类型与访问权 限等。) 在INFORMATION_SCHEMA中，有几张只读表。它们实际上是视图，而不是基本表。 </p>
</li>
</ul>
</li>
<li><p>mysql </p>
<ul>
<li>mysql的核心数据库，类似于sql server中的master表，主要负责存储数据库的用户、权限设置、关键字等mysql自己需要使用的控制和管理信息。(常用的，在mysql.user表中修改root用户的密码)。 </li>
</ul>
</li>
<li><p>performance_schema </p>
<ul>
<li>主要用于收集数据库服务器性能参数。并且库里表的存储引擎均为PERFORMANCE_SCHEMA，而用户是不能创建存储引擎为PERFORMANCE_SCHEMA的表。MySQL5.7默认是开启的。</li>
</ul>
</li>
<li><p>sys</p>
<ul>
<li>Sys库所有的数据源来自：performance_schema。目标是把performance_schema的把复杂度降低，让DBA能更好的阅读这个库里的内容。让DBA更快的了解DB的运行情况。 </li>
</ul>
</li>
</ul>
<h3 id="体系结构"><a href="#体系结构" class="headerlink" title="体系结构"></a>体系结构</h3><ul>
<li><p>客户端</p>
</li>
<li><p>服务层</p>
<ul>
<li>连接管理、查询缓存、查询解析、查询优化器</li>
</ul>
</li>
<li><p>存储引擎</p>
</li>
<li><p>执行流程</p>
</li>
</ul>
<p><img src="/images/pasted-51.png" alt="upload successful"></p>
<h3 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h3><p><code>MySQL</code>常见的存储引擎有<code>InnoDB</code>和<code>MyISAM</code>两种，其他<code>NDBCluster</code>、<code>Merge</code>、<code>Memory</code>等稍微了解即可。</p>
<ul>
<li><h4 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h4><ul>
<li>在InnoDB中，如果只需要查找索引的列，就尽量不要加入其它的列，这样会提高查询效率。</li>
<li><p>InnoDB 使用 B+Tree 作为索引结构，叶节点直接存储的是完整的数据记录，索引的 key 是数据表的主键,因此   InnoDB 表数据文件本身就是主索引。</p>
</li>
<li><p>查看InnoDB数据存储</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'innodb_file_per_table'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>如果innodb_file_per_table 为 ON 将建立独立的表空间，文件为tablename.ibd；</li>
<li><p>如果innodb_file_per_table 为 OFF 将数据存储到系统的共享表空间，文件为ibdataX（X为从1开始的整数）；</p>
<ul>
<li><p><code>MySQL5.5默认系统表空间与MySQL5.6及以后默认独立表空间</code></p>
</li>
<li><p>1.系统表空间无法简单的收缩文件大小，造成空间浪费，并会产生大量的磁盘碎片。</p>
</li>
<li><p>2.独立表空间可以通过optimeze table 收缩系统文件，不需要重启服务器也不会影响对表的正常访问。</p>
</li>
<li><p>3.如果对多个表进行刷新时，实际上是顺序进行的，会产生IO瓶颈。</p>
</li>
<li><p>4 独立表空间可以同时向多个文件刷新数据。</p>
</li>
<li><p>5 强烈建立对Innodb 使用独立表空间，优化什么的更方便，可控。</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>特性：支持事务和行级锁（具体说明参考事务和锁）</p>
<p> <strong>InnoDB的存储文件格式分为：</strong></p>
<pre><code>.frm:表结构定义信息
.ibd:表数据和索引数据
</code></pre></li>
<li><h4 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h4><ul>
<li>MyISAM存储引擎采用的是非聚簇索引，非聚簇索引的主索引和辅助索引几乎是一样的，只是主索引不允许重复，不允许空值，他们的叶子结点的key都存储指向键值对应的数据的物理地址。</li>
<li>非聚簇索引的数据表和索引表是分开存储的。</li>
<li>非聚簇索引中的数据是根据数据的插入顺序保存。因此非聚簇索引更适合单个数据的查询。插入顺序不受键值影响。</li>
<li>只有在MyISAM中才能使用FULLTEXT索引。</li>
<li>MyISAM 引擎默认使用 B+Tree 作为索引结构,叶节点的 data 域存放的是数据记录的地址。</li>
<li>MyISAM存储引擎的表在数据库中，每一个表都被存放为三个以表名命名的物理文件。首先肯定会有任何存储引擎都不可缺少的存放表结构定义信息的.frm文件，另外还有.MYD和.MYI文件，分别存放了表的数据（.MYD）和索引数据（.MYI）。每个表都有且仅有这样三个文件做为MyISAM存储类型的表的存储，也就是说不管这个表有多少个索引，都是存放在同一个.MYI文件中。</li>
<li><p>支持R-Tree索引、R-Tree索引、全文索引。</p>
<p><strong>MyISAM的存储文件格式分为：</strong></p>
<pre><code>.frm:表结构定义信息
.MYD:表的数据
.MYI:索引数据
</code></pre></li>
</ul>
</li>
</ul>
<ul>
<li><p>InnoDB和MyISAM的区别</p>
<ul>
<li>使用主索引的时候，更适合使用聚簇索引，因为聚簇索引只需要查找一次，而非聚簇索引在查到数据的地址后，还要进行一次I/O查找数据。</li>
<li>因为聚簇辅助索引存储的是主键的键值，因此可以在数据行移动或者页分裂的时候降低委会成本，因为这时不用维护辅助索引。但是辅助索引会占用更多的空间。</li>
<li>聚簇索引在插入新数据的时候比非聚簇索引慢很多，因为插入新数据时需要减压主键是否重复，这需要遍历主索引的所有叶节点，而非聚簇索引的叶节点保存的是数据地址，占用空间少，因此分布集中，查询的时候I/O更少，但聚簇索引的主索引中存储的是数据本身，数据占用空间大，分布范围更大，可能占用好多的扇区，因此需要更多次I/O才能遍历完毕。</li>
</ul>
</li>
<li><h4 id="Archive"><a href="#Archive" class="headerlink" title="Archive"></a>Archive</h4></li>
<li><p>Archive非常适合存储大量的独立的，作为历史记录的数据。因为它们不经常被读取。Archive 拥有高效的插入速度，但其对查询的支持相对较差。</p>
</li>
<li><h4 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h4></li>
<li><p>Memory所有数据置于内存的存储引擎，拥有极高的插入，更新和查询效率。但是会占用和数据量成正比的内存空间。并且其内容会在 MySQL 重新启动时丢失</p>
</li>
<li><h4 id="Merge"><a href="#Merge" class="headerlink" title="Merge"></a>Merge</h4></li>
<li><p>Merge是将一定数量的 MyISAM 表联合而成一个整体，在超大规模数据存储时很有用。</p>
</li>
<li><h4 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h4></li>
<li><p>逻辑上由逗号分割数据的存储引擎。它会在数据库子目录里为每个数据表创建一个 .csv 文件。这是一种普通文本文件，每个数据行占用一个文本行。CSV 存储引擎不支持索引。</p>
</li>
<li><h4 id="BlackHole"><a href="#BlackHole" class="headerlink" title="BlackHole"></a>BlackHole</h4></li>
<li><p>黑洞引擎，写入的任何数据都会消失，一般用于记录 binlog 做复制的中继。</p>
</li>
<li><h4 id="EXAMPLE"><a href="#EXAMPLE" class="headerlink" title="EXAMPLE"></a>EXAMPLE</h4></li>
<li><p>EXAMPLE 存储引擎是一个不做任何事情的存根引擎。它的目的是作为 MySQL 源代码中的一个例子，用来演示如何开始编写一个新存储引擎。同样，它的主要兴趣是对开发者。EXAMPLE 存储引擎不支持编索引。</p>
</li>
</ul>
<h3 id="数据预热"><a href="#数据预热" class="headerlink" title="数据预热"></a>数据预热</h3><p>默认情况，仅仅有某条数据被读取一次，才会缓存在<code>innodb_buffer_pool</code>。所以，数据库刚刚启动，须要进行数据预热，将磁盘上的全部数据缓存到内存中。数据预热能够提高读取速度。对于<code>InnoDB</code>数据库，能够用下面方法，进行数据预热。</p>
<ul>
<li><p>1.将下面脚本保存为 MakeSelectQueriesToLoad.sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">    <span class="keyword">CONCAT</span>(<span class="string">'SELECT '</span>,ndxcollist,<span class="string">' FROM '</span>,db,<span class="string">'.'</span>,tb,</span><br><span class="line">    <span class="string">' ORDER BY '</span>,ndxcollist,<span class="string">';'</span>) SelectQueryToLoadCache</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">SELECT</span></span><br><span class="line">            <span class="keyword">engine</span>,table_schema db,table_name tb,</span><br><span class="line">            index_name,<span class="keyword">GROUP_CONCAT</span>(column_name <span class="keyword">ORDER</span> <span class="keyword">BY</span> seq_in_index) ndxcollist</span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">SELECT</span></span><br><span class="line">                B.engine,A.table_schema,A.table_name,</span><br><span class="line">                A.index_name,A.column_name,A.seq_in_index</span><br><span class="line">            <span class="keyword">FROM</span></span><br><span class="line">               information_schema.statistics A <span class="keyword">INNER</span> <span class="keyword">JOIN</span></span><br><span class="line">                (</span><br><span class="line">                    <span class="keyword">SELECT</span> <span class="keyword">engine</span>,table_schema,table_name</span><br><span class="line">                    <span class="keyword">FROM</span> information_schema.tables <span class="keyword">WHERE</span></span><br><span class="line">                    <span class="keyword">engine</span>=<span class="string">'InnoDB'</span></span><br><span class="line">                ) B <span class="keyword">USING</span> (table_schema,table_name)</span><br><span class="line">            <span class="keyword">WHERE</span> B.table_schema <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">'information_schema'</span>,<span class="string">'mysql'</span>)</span><br><span class="line">            <span class="keyword">ORDER</span> <span class="keyword">BY</span> table_schema,table_name,index_name,seq_in_index</span><br><span class="line">        ) A</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> table_schema,table_name,index_name</span><br><span class="line">    ) AA</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> db,tb</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.运行</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -AN &lt; /root/MakeSelectQueriesToLoad.sql &gt; /root/SelectQueriesToLoad.sql</span><br></pre></td></tr></table></figure>
<ul>
<li>3.加入启动脚本到 my.cnf<br><code></code>bash<br>vim /etc/my.cnf</li>
</ul>
<p>[mysqld]</p>
<p>init-file=/var/lib/mysql/upcache.sql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### MySQL执行线程</span><br><span class="line"></span><br><span class="line">**1、查看`MySQL`当前连接数**</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">show full processlist;</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/pasted-44.png" alt="upload successful"></p>
<p>statistics 状态的线程，表示正在计算统计数据，以制定一个查询执行计划。 如果一个线程很长一段时间处于这种状态，可能是磁盘绑定的，即磁盘IO性能很差，说到底就是数据库服务器IO遇到问题了，可以通过增加 <code>buffer_pool</code> 来缓存更多的数据，或者提高服务器IO能力，可能磁盘在执行其他工作。</p>
<p>服务器IO状态会一直占用cpu，导致性能严重下降。</p>
<p><img src="/images/pasted-50.png" alt="upload successful"></p>
<p><strong>2、显示<code>MySQL</code>状态</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show status;</span><br></pre></td></tr></table></figure>
<ul>
<li>Aborted_clients 由于客户没有正确关闭连接已经死掉，已经放弃的连接数量。</li>
<li>Aborted_connects 尝试已经失败的MySQL服务器的连接的次数。</li>
<li>Connections 试图连接MySQL服务器的次数。</li>
<li>Created_tmp_tables 当执行语句时，已经被创造了的隐含临时表的数量。</li>
<li>Delayed_insert_threads 正在使用的延迟插入处理器线程的数量。</li>
<li>Open_tables 打开表的数量。</li>
<li>Open_files 打开文件的数量。</li>
<li>Open_streams 打开流的数量(主要用于日志记载）</li>
<li>Opened_tables 已经打开的表的数量。</li>
<li>Questions 发往服务器的查询的数量。</li>
<li>Slow_queries 要花超过long_query_time时间的查询数量。</li>
<li>Threads_connected 当前打开的连接的数量。</li>
<li>Threads_running 不在睡眠的线程数量。</li>
<li>Uptime 服务器工作了多少秒。</li>
</ul>
<p><strong>3、终止正在执行的<code>MySQL</code>线程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> id;</span><br></pre></td></tr></table></figure>
<p>杀死耗时或者长时间处于<code>Sending to Client</code>状态的慢sql。</p>
<p><strong>减少磁盘绑定：</strong></p>
<ul>
<li><p>1) 扩大<code>innodb_buffer_pool_size</code>的缓冲池大小。如果你用Innodb然后，当表数据缓存在InnoDB缓冲池中时，可以通过查询一次又一次地处理表数据，而不需要任何磁盘I/O。这个内存区域非常重要，以至于繁忙的数据库通常指定的大小约为物理内存量的80%。</p>
</li>
<li><p>2) 在GNU/Linux和Unix的某些版本中，使用Unixfsync()调用(InnoDB默认使用)将文件刷新到磁盘，类似的方法非常慢。如果数据库写入性能是一个问题，则使用INNODB_FLUSH_Method参数设置为O_DSYNC进行基准测试。</p>
</li>
<li><p>3) 扩大<code>innodb_buffer_pool_size</code>的数据库日志缓冲区大小-设置分配给存储InnoDB预写日志条目的缓冲区的内存量。对于大型事务，可以将日志加载到日志缓冲区中，而不是将日志写入磁盘上的日志文件，直到日志缓冲区在每次事务提交时被刷新为止。如果您在运行时在显示nodb状态输出中看到大型日志I/O，则可能需要为innodb_log_buffer_size参数设置更大的值，以保存磁盘I/O。</p>
</li>
<li><p>4) 增加用于缓存表和查询的内存-检查表和查询的缓存命中率，检查并增加这些MySQL变量：query_cache_size, query_cache_limit, query_cache_min_res_unit, tmp_table_size, join_buffer_size , sort_buffer_size等等。</p>
</li>
<li><p>5) 确保对服务器上的所有表都应用了适当的索引，并使用正确的数据类型。</p>
</li>
</ul>
<p>   <code>建议：查看当前io性能状态，例如iostat</code></p>
<p><img src="/images/pasted-45.png" alt="upload successful"></p>
<h3 id="SQL调优"><a href="#SQL调优" class="headerlink" title="SQL调优"></a>SQL调优</h3><ul>
<li><h4 id="SQL执行顺序"><a href="#SQL执行顺序" class="headerlink" title="SQL执行顺序"></a>SQL执行顺序</h4></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM &lt;left_table&gt;</span><br><span class="line">ON &lt;join_condition&gt;</span><br><span class="line">&lt;join_type&gt; JOIN &lt;right_table&gt;</span><br><span class="line">WHERE &lt;where_condition&gt;</span><br><span class="line">GROUP BY &lt;group_by_list&gt;</span><br><span class="line">HAVING &lt;having_condition&gt;</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">DISTINCT</span> &lt;select_list&gt;</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> &lt;order_by_condition&gt;</span><br><span class="line"><span class="keyword">LIMIT</span> &lt;limit_number&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><h4 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h4></li>
<li><p>禁用select *</p>
</li>
<li>使用select count(*) 统计行数</li>
<li>尽量少运算</li>
<li>尽量避免全表扫描，如果可以，在过滤列建立索引</li>
<li>尽量避免在where子句对字段进行null判断</li>
<li>尽量避免在where子句使用!= 或者&lt;&gt;</li>
<li>尽量避免在where子句使用or连接</li>
<li>尽量避免对字段进行表达式计算</li>
<li>尽量避免对字段进行函数操作</li>
<li>尽量避免使用不是复合索引的前缀列进行过滤连接</li>
<li>尽量少排序，如果可以，建立索引</li>
<li>尽量少join</li>
<li>尽量用join代替子查询</li>
<li>尽量避免在where子句中使用in,not in或者having，使用exists,not exists代替</li>
<li>尽量避免两端模糊匹配 like %*%</li>
<li>尽量用union all代替union</li>
<li>尽量早过滤</li>
<li>避免类型转换</li>
<li>尽量批量insert</li>
<li>优先优化高并发sql，而不是频率低的大sql</li>
<li>尽可能对每一条sql进行explain</li>
<li>尽可能从全局出发</li>
</ul>
<ul>
<li><h4 id="Order-By优化"><a href="#Order-By优化" class="headerlink" title="Order By优化"></a>Order By优化</h4></li>
<li><p>filesort优化算法.</p>
</li>
<li><p>在mysql version()&lt;4.1之前，优化器采用的是filesort第一种优化算法，先提取键值和指针，排序后再去提取数据，前后要搜索数据两次，第一次若能使用索引则使用，第二次是随机读(当然不同引擎也不同)。mysql version()&gt;=4.1,更新了一个新算法，就是在第一次读的时候也把selcet的列也读出来，然后在sort_buffer_size中排序(不够大则建临时表保存排序顺序)，这算法只需要一次读取数据。所以有这个广为人传的一个优化方法，那就是增大sort_buffer_size。Filesort第二种算法要用到更的空间，sort_buffer_size不够大反而会影响速度，所以mysql开发团队定了个变量max_length_for_sort_data，当算法中读出来的需要列的数据的大小超过该变量的值才使用，所以一般性能分析的时候会尝试把max_length_for_sort_data改小。</p>
</li>
<li><p>单独order by 用不了索引，索引考虑加where 或加limit。</p>
</li>
<li><p>当order by 和 group by无法使用索引时，增大max_length_for_sort_data参数设置和增大sort_buffer_size参数的设置。</p>
</li>
</ul>
<h3 id="索引命中-amp-失效"><a href="#索引命中-amp-失效" class="headerlink" title="索引命中&amp;失效"></a>索引命中&amp;失效</h3><p>索引是一种特殊的文件（InnoDB 数据表上的索引是表空间的一个组成部分），它们包含着对数据表里所有记录的引用指针。索引不是万能的，索引可以加快数据检索操作，但会使数据修改操作变慢。每修改数据记录，索引就必须刷新一次。为了在某种程度上弥补这一缺陷，许多 SQL 命令都有一个 DELAY_KEY_WRITE 项。这个选项的作用是暂时制止 MySQL 在该命令每插入一条新记录和每修改一条现有之后立刻对索引进行刷新，对索引的刷新将等到全部记录插入/修改完毕之后再进行。在需要把许多新记录插入某个数据表的场合，DELAY_KEY_WRITE 选项的作用将非常明显。另外，索引还会在硬盘上占用相当大的空间。因此应该只为最经常查询和最经常排序的数据列建立索引。注意，如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。</p>
<blockquote><p><strong>数据库表的索引从数据存储方式上可以分为聚簇索引和非聚簇索引（又叫二级索引）两种。</strong></p>
</blockquote>
<ul>
<li><h4 id="聚簇索引"><a href="#聚簇索引" class="headerlink" title="聚簇索引"></a>聚簇索引</h4></li>
</ul>
<p>Innodb的聚簇索引在同一个B-Tree中保存了索引列和具体的数据，在聚簇索引中，实际的数据保存在叶子页中，中间的节点页保存指向下一层页面的指针。“聚簇”的意思是数据行被按照一定顺序一个个紧密地排列在一起存储。一个表只能有一个聚簇索引，因为在一个表中数据的存放方式只有一种。</p>
<ul>
<li><p>聚簇索引的优点</p>
<ul>
<li>聚簇索引将索引和数据行保存在同一个B-Tree中，查询通过聚簇索引可以直接获取数据，相比非聚簇索引需要   第二次查询（非覆盖索引的情况下）效率要高。</li>
<li>聚簇索引对于范围查询的效率很高，因为其数据是按照大小排列的，</li>
</ul>
</li>
<li><p>聚簇索引的缺点</p>
<ul>
<li>聚簇索引的更新代价比较高，如果更新了行的聚簇索引列，就需要将数据移动到相应的位置。这可能因为要插   入的页已满而导致“页分裂”。</li>
<li>插入速度严重依赖于插入顺序，按照主键进行插入的速度是加载数据到Innodb中的最快方式。如果不是按照主   键插入，最好在加载完成后使用OPTIMIZE TABLE命令重新组织一下表。</li>
<li>聚簇索引在插入新行和更新主键时，可能导致“页分裂”问题。</li>
<li>聚簇索引可能导致全表扫描速度变慢，因为可能需要加载物理上相隔较远的页到内存中（需要耗时的磁盘寻道操作）。</li>
</ul>
</li>
<li><h4 id="非聚簇索引"><a href="#非聚簇索引" class="headerlink" title="非聚簇索引"></a>非聚簇索引</h4></li>
</ul>
<p>非聚簇索引，又叫二级索引。二级索引的叶子节点中保存的不是指向行的物理指针，而是行的主键值。当通过二级索引查找行，存储引擎需要在二级索引中找到相应的叶子节点，获得行的主键值，然后使用主键去聚簇索引中查找数据行，这需要两次B-Tree查找。</p>
<ul>
<li><h4 id="普通索引"><a href="#普通索引" class="headerlink" title="普通索引"></a>普通索引</h4></li>
</ul>
<p>普通索引（由关键字 KEY 或 INDEX 定义的索引）的任务是加快对数据的访问速度。因此，应该只为那些最经常出现查询条件（WHERE column =）或排序条件（ORDER BY column）中的数据列创建索引。只要有可能，就应该选择一个数据最整齐、最紧凑的数据列（如一个整数类型的数据列）来创建索引。</p>
<ul>
<li><h4 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h4></li>
</ul>
<p>与”普通索引”类似，不同的就是：索引列的值必须唯一，但允许有空值。</p>
<ul>
<li><h4 id="主键索引"><a href="#主键索引" class="headerlink" title="主键索引"></a>主键索引</h4></li>
</ul>
<p>主键索引是一种特殊的唯一索引，不允许有空值，这个索引就是所谓的“主索引”。主索引区别是：前者在定义时使用的关键字是 PRIMARY 而不是 UNIQUE。</p>
<ul>
<li><h4 id="BTree索引"><a href="#BTree索引" class="headerlink" title="BTree索引"></a>BTree索引</h4></li>
</ul>
<p>叶子结点指针都为null；<br>非叶子结点的key都是[key,data]二元组，其中key表示作为索引的键，data为键值所在行的数据；<br>BTree的结构下，就可以使用二分查找的查找方式，查找复杂度为h*log(n)，一般来说树的高度是很小的，一般为3左右，因此BTree是一个非常高效的查找结构。</p>
<ul>
<li><h4 id="B-Tree索引"><a href="#B-Tree索引" class="headerlink" title="B+Tree索引"></a>B+Tree索引</h4></li>
</ul>
<p>B+Tree是BTree的一个变种，设d为树的度数，h为树的高度，B+Tree和BTree的不同主要在于：<br>B+Tree中的非叶子结点不存储数据，只存储键值；<br>B+Tree的叶子结点没有指针，所有键值都会出现在叶子结点上，且key存储的键值对应的数据的物理地址；</p>
<ul>
<li><h4 id="组合索引"><a href="#组合索引" class="headerlink" title="组合索引"></a>组合索引</h4></li>
</ul>
<p>遵循最左前缀原则，索引可以覆盖多个数据列，如像 INDEX (columnA, columnB) 索引。这种索引的特点是 MySQL 可以有选择地使用一个这样的索引。如果查询操作只需要用到 columnA 数据列上的一个索引，就可以使用复合索引 INDEX(columnA, columnB)。不过，这种用法仅适用于在复合索引中排列在前的数据列组合。比如说，INDEX (A，B，C) 可以当做 A 或 (A,B) 的索引来使用，但不能当做 B、C 或 (B,C) 的索引来使用。</p>
<ul>
<li><h4 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h4></li>
</ul>
<p>仅可用于 MyISAM 表，针对较大的数据，生成全文索引很耗时好空间。</p>
<p><strong>索引失效</strong></p>
<p>关联字段类型不同<br>索引字段使用函数表达式<br>like %AAA<br>is null</p>
<ul>
<li><p>GROUP BY 的索引应用</p>
<ul>
<li>1、查询字段必须和后面GROUP BY 一致<br>select TeamID from competeinfo where TeamID &gt;10 group by TeamID。<br>这里就是通过TeamID 来查找。完成group by 。</li>
<li>2、联合索引的应用，切记注意GROUP BY 顺序，Where 条件和GROUP BY 字段得是一个索引里面的<br>这个表CompeteID,TeamID建立联合索引<br>1）select TeamID from competeinfo where TeamID &gt;10 and CompeteID &gt; 100020 group by CompeteID<br>这个查询用到了CompeteID,TeamID联合索引<br>2）select TeamID from competeinfo where TeamID &gt;10 and CompeteID &gt; 100020 group by TeamID<br>这样的话查询group by中就没有用到索引了</li>
</ul>
</li>
</ul>
<pre><code>下面是总结的是联合索引的使用：
Index（Name，Age）表示在Name，Age两列上建立联合索引
如果where name=&apos;pp&apos; 能使用索引
where age=25时不能使用索引
where name=&apos;pp&apos; and age&gt;25 能使用索引 
where name =&apos;pp&apos; order by age 能使用索引
where name&gt;&apos;pp&apos; order by age 不能使用索引
where name&gt;&apos;pp&apos; order by name,age 能使用索引
order by name asc age desc 将不能使用索引！
</code></pre><h3 id="主从配置文件"><a href="#主从配置文件" class="headerlink" title="主从配置文件"></a>主从配置文件</h3><p>MySQL主从复制时时同步，是在开启log-bin日志文件的基础上，开始的时候记录主库的Position，作为从库同步的开始节点,所以主从库都必须开启log-bin日志，恢复数据也是根据此文件来操作要恢复的节点。</p>
<p>查看主库Position：</p>
<p><img src="/images/pasted-52.png" alt="upload successful"></p>
<h4 id="主库配置"><a href="#主库配置" class="headerlink" title="主库配置"></a>主库配置</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">replication</span> <span class="keyword">slave</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'root'</span>@<span class="string">'10.10.253.%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
<h4 id="主库配置文件"><a href="#主库配置文件" class="headerlink" title="主库配置文件"></a>主库配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装目录</span></span><br><span class="line">basedir = /usr/<span class="built_in">local</span>/mysql</span><br><span class="line"><span class="comment">#数据目录</span></span><br><span class="line">datadir = /usr/<span class="built_in">local</span>/mysql/data</span><br><span class="line"><span class="comment">#端口</span></span><br><span class="line">port = 3306</span><br><span class="line"><span class="comment">#socket 路径</span></span><br><span class="line">socket = /var/lib/mysql/mysql.sock</span><br><span class="line"><span class="comment">#log-bin日志文件</span></span><br><span class="line"><span class="built_in">log</span>-bin=mysql-bin-1</span><br><span class="line"><span class="comment">#serverId，一般为ip的最后一段，避免重复</span></span><br><span class="line">server_id=119</span><br><span class="line"><span class="comment">#开启查询缓存</span></span><br><span class="line">explicit_defaults_for_timestamp=<span class="literal">true</span></span><br><span class="line"><span class="comment">#设置最新日志保留时间，节省磁盘空间</span></span><br><span class="line">expire_logs_days = 10</span><br><span class="line"><span class="comment">#sql_mode模式，定义了mysql应该支持的sql语法，数据校验等</span></span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="sql-mode"><a href="#sql-mode" class="headerlink" title="sql_mode"></a>sql_mode</h4><p><strong>常见的sql_mode有以下几种</strong></p>
<h5 id="NO-ENGINE-SUBSTITUTION模式"><a href="#NO-ENGINE-SUBSTITUTION模式" class="headerlink" title="NO_ENGINE_SUBSTITUTION模式"></a>NO_ENGINE_SUBSTITUTION模式</h5><ul>
<li>如果需要的存储引擎被禁用或未编译，那么抛出错误。不设置此值时，用默认的存储引擎替代，并抛出一个异常。<h5 id="STRICT-TRANS-TABLES模式"><a href="#STRICT-TRANS-TABLES模式" class="headerlink" title="STRICT_TRANS_TABLES模式"></a>STRICT_TRANS_TABLES模式</h5></li>
<li>严格模式，进行数据的严格校验，错误数据不能插入，报error错误。在该模式下，如果一个值不能插入到一个事务表中，则中断当前的操作，对非事务表不做限制。<h5 id="ANSI模式"><a href="#ANSI模式" class="headerlink" title="ANSI模式"></a>ANSI模式</h5></li>
<li>宽松模式，对插入数据进行校验，如果不符合定义类型或长度，对数据类型调整或截断保存，报warning警告。 <h5 id="TRADITIONAL模式"><a href="#TRADITIONAL模式" class="headerlink" title="TRADITIONAL模式"></a>TRADITIONAL模式</h5></li>
<li>严格模式，当向mysql数据库插入数据时，进行数据的严格校验，保证错误数据不能插入，报error错误。用于事物时，会进行事物的回滚。 <h5 id="ONLY-FULL-GROUP-BY模式"><a href="#ONLY-FULL-GROUP-BY模式" class="headerlink" title="ONLY_FULL_GROUP_BY模式"></a>ONLY_FULL_GROUP_BY模式</h5></li>
<li>出现在select语句、HAVING条件和ORDER BY语句中的列，必须是GROUP BY的列或者依赖于GROUP BY列的函数列。<h5 id="NO-AUTO-VALUE-ON-ZERO模式"><a href="#NO-AUTO-VALUE-ON-ZERO模式" class="headerlink" title="NO_AUTO_VALUE_ON_ZERO模式"></a>NO_AUTO_VALUE_ON_ZERO模式</h5></li>
<li>该值影响自增长列的插入。默认设置下，插入0或NULL代表生成下一个自增长值。如果用户希望插入的值为0，而该列又是自增长的，那么这个选项就有用了。<h5 id="NO-ZERO-IN-DATE模式"><a href="#NO-ZERO-IN-DATE模式" class="headerlink" title="NO_ZERO_IN_DATE模式"></a>NO_ZERO_IN_DATE模式</h5></li>
<li>这个模式影响了是否允许日期中的月份和日包含0。如果开启此模式，2016-01-00是不允许的，但是0000-02-01是允许的。它实际的行为受到 strict mode是否开启的影响1。<h5 id="NO-AUTO-CREATE-USER模式"><a href="#NO-AUTO-CREATE-USER模式" class="headerlink" title="NO_AUTO_CREATE_USER模式"></a>NO_AUTO_CREATE_USER模式</h5></li>
<li>禁止GRANT创建密码为空的用户<h5 id="ANSI-QUOTES模式"><a href="#ANSI-QUOTES模式" class="headerlink" title="ANSI_QUOTES模式"></a>ANSI_QUOTES模式</h5></li>
<li>启用ANSI_QUOTES后，不能用双引号来引用字符串，因为它被解释为识别符。</li>
</ul>
<h4 id="从库设置"><a href="#从库设置" class="headerlink" title="从库设置"></a>从库设置</h4><ul>
<li>根据查看到的主库status，记录log-bin和position。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">change</span> <span class="keyword">master</span> <span class="keyword">to</span> master_host=<span class="string">'192.168.80.9'</span>,master_user=<span class="string">'root'</span>,master_password=<span class="string">'123456'</span>,master_log_file=<span class="string">'mysql-bin-1.000003'</span>,master_log_pos=<span class="number">13177757</span> ;</span><br></pre></td></tr></table></figure>
<h4 id="从库配置文件"><a href="#从库配置文件" class="headerlink" title="从库配置文件"></a>从库配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装目录</span></span><br><span class="line">basedir = /usr/<span class="built_in">local</span>/mysql</span><br><span class="line"><span class="comment">#数据目录</span></span><br><span class="line">datadir = /usr/<span class="built_in">local</span>/mysql/data</span><br><span class="line"><span class="comment">#端口</span></span><br><span class="line">port = 3306</span><br><span class="line"><span class="comment">#socket 路径</span></span><br><span class="line">socket = /var/lib/mysql/mysql.sock</span><br><span class="line"><span class="comment">#log-bin日志文件</span></span><br><span class="line"><span class="built_in">log</span>-bin=mysql-bin-1</span><br><span class="line"><span class="comment">#serverId，一般为ip的最后一段，避免重复</span></span><br><span class="line">server_id=119</span><br><span class="line"><span class="comment">#开启查询缓存</span></span><br><span class="line">explicit_defaults_for_timestamp=<span class="literal">true</span></span><br><span class="line"><span class="comment">#设置需要同步主库的DB</span></span><br><span class="line">replicate-do-db=hsg_oa</span><br><span class="line"><span class="comment">#设置不需要同步主库的DB</span></span><br><span class="line">replicate-ignore-db=information_schema,mysql,performance_schema,sys</span><br></pre></td></tr></table></figure>
<p><code>删除主从库data下面的auto.cnf，会导致主从库同步节点不一致问题。</code></p>
<h4 id="默认配置参数"><a href="#默认配置参数" class="headerlink" title="默认配置参数"></a>默认配置参数</h4><ul>
<li>sort_buffer_size <ul>
<li>定义了每个线程排序缓存区的大小，MySQL在有查询、需要做排序操作时才会为每个缓冲区分配内存（直接分配该参数的全部内存）；</li>
</ul>
</li>
<li>join_buffer_size <ul>
<li>定义了每个线程所使用的连接缓冲区的大小，如果一个查询关联了多张表，MySQL会为每张表分配一个连接缓冲，导致一个查询产生了多个连接缓冲；</li>
</ul>
</li>
<li>read_buffer_size <ul>
<li>定义了当对一张MyISAM进行全表扫描时所分配读缓冲池大小，MySQL有查询需要时会为其分配内存，其必须是4k的倍数；</li>
</ul>
</li>
<li>read_rnd_buffer_size <ul>
<li>索引缓冲区大小，MySQL有查询需要时会为其分配内存，只会分配需要的大小。</li>
</ul>
</li>
</ul>
<p><code>注意：以上四个参数是为一个线程分配的，如果有100个连接，那么需要×100。</code></p>
<p><strong>MySQL数据库实例：</strong></p>
<ul>
<li><p>MySQL是单进程多线程（而oracle是多进程），也就是说MySQL实例在系统上表现就是一个服务进程，即进程；</p>
</li>
<li><p>MySQL实例是线程和内存组成，实例才是真正用于操作数据库文件的；</p>
</li>
<li><p>一般情况下一个实例操作一个或多个数据库；集群情况下多个实例操作一个或多个数据库。</p>
</li>
</ul>
<p><strong>如何为缓存池分配内存：</strong></p>
<ul>
<li>Innodb_buffer_pool_size，定义了Innodb所使用缓存池的大小，对其性能十分重要，必须足够大，但是过大时，使得Innodb 关闭时候需要更多时间把脏页从缓冲池中刷新到磁盘中；</li>
</ul>
<p><strong>总内存-（每个线程所需要的内存*连接数）-系统保留内存</strong></p>
<ul>
<li><p>key_buffer_size，定义了MyISAM所使用的缓存池的大小，由于数据是依赖存储操作系统缓存的，所以要为操作系统预留更大的内存空间；</p>
</li>
<li><p>select sum(index_length) from information_schema.talbes where engine=’myisam’</p>
</li>
</ul>
<p><code>注意：即使开发使用的表全部是Innodb表，也要为MyISAM预留内存，因为MySQL系统使用的表仍然是MyISAM表。max_connections 控制允许的最大连接数，一般2000更大。不要使用外键约束保证数据的完整性。</code></p>
<h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p><strong>事务性存储引擎及主要日志类型：Redo Log 、 Undo Log 和 general log</strong></p>
<ul>
<li>Redo Log：实现事务的持久性(已提交的事务)。</li>
<li>Undo Log：未提交的事务，独立于表空间，需要随机访问，可以存储在高性能io设备上</li>
<li>general log：mysql将对DB的所有操作都可以记录在general log中，我们可以在线开启也可以通过修改初始化参数开启，调试用。</li>
</ul>
<p><strong>主要说明一下general log的使用：</strong></p>
<p>在线打开和关闭<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> global general_log=on;</span><br><span class="line"><span class="built_in">set</span> global general_log=off;</span><br></pre></td></tr></table></figure></p>
<p>通过下面sql方法可以查看mysql.general_log表的存储引擎是什么<br>show table status from mysql where name=’general_log’;</p>
<p>这个表的缺省存储引擎是CSV，我们可以将该存储引擎修改成myisam来达到更好的性能。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table mysql.general_log engine=myisam;</span><br><span class="line">1580 - You cannot <span class="string">'ALTER'</span> a <span class="built_in">log</span> table <span class="keyword">if</span> logging is enabled</span><br><span class="line">mysql&gt; <span class="built_in">set</span> global general_log=off;</span><br><span class="line">Query OK, 0 rows affected</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table mysql.general_log engine=myisam;</span><br><span class="line">Query OK, 11 rows affected</span><br><span class="line">Records: 11  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global general_log=on;</span><br><span class="line">Query OK, 0 rows affected</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/pasted-49.png" alt="upload successful"></p>
<p><strong>记录general log可以很好的监控当前数据库中的所有操作，可以选择在忙时打开，这样就可以对性能进行优化。<br>但general log比较消耗系统性能，生产系统不建议打开</strong></p>
<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p><strong>视图概述</strong></p>
<p>视图本身是一个虚拟表，不存放任何数据，查询视图的数据集由其他表生成。<code>MySQL</code>底层通过两种算法来实现视图：临时表算法（TEMPTABLE）和合并算法（MERGE）。</p>
<p>临时表算法就是将SELECT语句的结果存放到临时表中，当需要访问视图的时候，直接访问这个临时表即可。</p>
<p>相比于其它关系型数据库的视图，<code>MySQL</code>的视图在功能上会弱很多，比如ORACLE和MS SQL SERVER都支持物化视图。物化视图是指将视图结果数据存放在一个可以查询的表中，并定期从原始表中刷新数据到这张表中，这张表和普通物理表一样，可以创建索引、主键约束等等，性能相比于临时表会有质的提升。但遗憾的是<code>MySQL</code>目前并不支持物化视图，当然<code>MySQL</code>也不支持在视图中创建索引。</p>
<p>视图的实现算法是视图本身的属性决定的，跟作用在视图上的SQL没有任何关系。一般来说，只要原表记录和视图中的记录无法建立一一映射的关系时，<code>MySQL</code>都将使用临时表算法来实现视图。比如创建视图的SQL中包含GROUP BY、DISTINCT、UNION、聚合函数、子查询的时候，视图都将采用临时表算法（这些规则在以后的版本中，可能会发生改变，具体请参考官方手册）</p>
<p><strong>视图用途</strong></p>
<p>首先视图可以简化应用上层的操作，让应用更专注于其所关心的数据。其次，视图能够对敏感数据提供安全保护，比如：对不同的用户定义不同的视图，可以使敏感数据不出现在不应该看到这些数据的用户视图上；也可以使用视图实现基于列的权限控制，而不需要真正的在数据库中创建列权限。再者，视图可以方便系统运维，比如：在重构schema的时候使用视图，使得在修改视图底层表结构的时候，应用代码还可以继续运行不报错。</p>
<h3 id="Explain-amp-Profiling"><a href="#Explain-amp-Profiling" class="headerlink" title="Explain&amp;Profiling"></a>Explain&amp;Profiling</h3><ul>
<li><h4 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h4></li>
<li><p>使用EXPLAIN关键字可以模拟优化器执行SQL查询语句，从而知道MySQL是 如何处理你的SQL语句的。分析你的查询语句或是表结构的性能瓶颈。</p>
</li>
<li><p>使用方式：Explain+SQL语句</p>
</li>
<li><p>详细参数说明参见<a href="https://segmentfault.com/a/1190000008131735" target="_blank" rel="noopener">MySQL 性能优化神器 Explain 使用分析</a>，里面写的很有特点。</p>
</li>
</ul>
<ul>
<li><h4 id="Profiling"><a href="#Profiling" class="headerlink" title="Profiling"></a>Profiling</h4><ul>
<li>开启profiling设置</li>
</ul>
</li>
</ul>
<p><strong>查看profiling信息状态: on为开启，off关闭</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%profiling%'</span>;    </span><br><span class="line"><span class="keyword">set</span> profiling=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>执行SQL查询 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> oa_sign_in ; </span><br><span class="line"><span class="keyword">show</span>  <span class="keyword">profiles</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-46.png" alt="upload successful"></p>
<p><img src="/images/pasted-47.png" alt="upload successful"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show profile cpu,block io <span class="keyword">for</span> query 168;</span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-48.png" alt="upload successful"></p>
<blockquote><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ul>
<li><p><a href="https://dba.stackexchange.com/questions/55969/statistics-state-in-mysql-processlist" target="_blank" rel="noopener">statistics State in MySQL Processlist</a></p>
</li>
<li><p><a href="http://mysqlinternals.blogspot.com/2015/05/list-of-background-operations-performed.html" target="_blank" rel="noopener">List of background operations performed by MySQL InnoDB Main thread</a></p>
</li>
<li><p><a href="http://imysql.com/2015/06/10/mysql-faq-processlist-thread-states.shtml" target="_blank" rel="noopener">processlist中哪些状态要引起关注</a></p>
</li>
<li><p><a href="http://imysql.com/2016/11/20/mysql-faq-what-cause-diskio-so-high.shtml" target="_blank" rel="noopener">是什么导致MySQL数据库服务器磁盘I/O高？</a></p>
</li>
<li><p><a href="http://seanlook.com/2017/10/13/mysql-table_open_cache_file_limits" target="_blank" rel="noopener">table_open_cache 与 table_definition_cache 对MySQL(内存)的影响</a></p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/5.6/en/optimizing-innodb-diskio.html" target="_blank" rel="noopener">8.5.8 Optimizing InnoDB Disk I/O</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/huanongying/p/7021555.html" target="_blank" rel="noopener">MySQL的四种事务隔离级别</a></p>
</li>
<li><p><a href="https://blog.csdn.net/whoamiyang/article/details/51901888" target="_blank" rel="noopener">轻松理解MYSQL MVCC 实现机制</a></p>
</li>
<li><p><a href="https://segmentfault.com/a/1190000013672421" target="_blank" rel="noopener">MySQL性能管理及架构设计</a></p>
</li>
<li><p><a href="http://www.uml.org.cn/sjjm/201107145.asp#nav-4-2" target="_blank" rel="noopener">MySQL索引背后的数据结构及算法原理</a></p>
</li>
</ul>
</blockquote>
      
    </div>

    

    
    
    
	
	 
	
          
          <div class="social_share">
            
               <div>
                 
  <div class="bdsharebuttonbox">
    <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="fa fa-tencent-weibo bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a>
    <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>	
    <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="分享到微信"></a>
	<a href="#" class="fa fa-renren bds_renren" data-cmd="renren" title="分享到人人网"></a>
    <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="fa fa-facebook bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    
    <a class="fa fa-share-alt bds_more" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "24",
        "bdStyle": "2"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "24"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

               </div>
            
            
          </div>
        
	 	

    



    

    <footer class="post-footer">
     <!-- 
  
      
        <div class="post-tags">
          
            <a href="/tags/事务/" rel="tag"><i class="fa fa-tag"></i> 事务</a>
          
            <a href="/tags/mysql/" rel="tag"><i class="fa fa-tag"></i> mysql</a>
          
            <a href="/tags/优化/" rel="tag"><i class="fa fa-tag"></i> 优化</a>
          
            <a href="/tags/sql/" rel="tag"><i class="fa fa-tag"></i> sql</a>
          
            <a href="/tags/主从配置/" rel="tag"><i class="fa fa-tag"></i> 主从配置</a>
          
            <a href="/tags/索引/" rel="tag"><i class="fa fa-tag"></i> 索引</a>
          
            <a href="/tags/存储引擎/" rel="tag"><i class="fa fa-tag"></i> 存储引擎</a>
          
        </div>
      
	  -->
	  
	  
		  
			
			
		  <div>
			<div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>如果文章对你有帮助，欢迎点击上方按钮打赏作者!</div>
  <br>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="志文 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.png" alt="志文 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

		  </div>
     
	 

      
      
        <div class="post-widgets">
        

        

        
        </div>
      
      
	  
	  
	  
	   <!--
	   <div>
		
			<div style="text-align:center;color: #f5871f;font-size:14px;"><br/><br/>-------------&nbsp;&nbsp;本文结束&nbsp;&nbsp;<i class="fa fa-paw"></i>&nbsp;&nbsp;感谢您的阅读&nbsp;&nbsp;-------------<br/><br/></div>
		
		</div>
		-->
		
     


      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/02/10/Jenkins自动化安装部署-权限配置（三）/" rel="next" title="Jenkins自动化安装部署-权限配置（三）">
                <i class="fa fa-chevron-left"></i> Jenkins自动化安装部署-权限配置（三）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/02/21/JDK8新特性/" rel="prev" title="JAVA 8新特性">
                JAVA 8新特性 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
 

  </article>


  </div>


          </div>
          

  
    <div id="gitalk-container">
    </div>
    
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/jackie.png" alt="志文">
            
              <p class="site-author-name" itemprop="name">志文</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">47</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/yangzhiwen911" title="GitHub &rarr; https://github.com/yangzhiwen911" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:yangzhiwen911@gmail.com" title="E-Mail &rarr; mailto:yangzhiwen911@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.softwhy.com/" title="http://www.softwhy.com/" rel="noopener" target="_blank">蚂蚁部落</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ziyuan.baidu.com/" title="https://ziyuan.baidu.com/" rel="noopener" target="_blank">百度SEO</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://fontawesome.dashgame.com/" title="http://fontawesome.dashgame.com/" rel="noopener" target="_blank">图标大全</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.csdn.net/plei_yue/article/details/78930287" title="https://blog.csdn.net/plei_yue/article/details/78930287" rel="noopener" target="_blank">SpringBoot[csdn]</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://jm.taobao.org/" title="http://jm.taobao.org/" rel="noopener" target="_blank">阿里中间件</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://yq.aliyun.com/articles/" title="https://yq.aliyun.com/articles/" rel="noopener" target="_blank">云栖社区</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://cmsblogs.com/" title="http://cmsblogs.com/" rel="noopener" target="_blank">JAVA技术栈</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.fangzhipeng.com/page4/" title="https://www.fangzhipeng.com/page4/" rel="noopener" target="_blank">源码解析大全</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://yq.aliyun.com/articles/679638?spm=a2c4e.11157919.spm-cont-list.190.160427ae85fT58" title="https://yq.aliyun.com/articles/679638?spm=a2c4e.11157919.spm-cont-list.190.160427ae85fT58" rel="noopener" target="_blank">JAVA知识</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://cmsblogs.com/?p=2611" title="http://cmsblogs.com/?p=2611" rel="noopener" target="_blank">JAVA并发</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://cmsblogs.com/?p=3819" title="http://cmsblogs.com/?p=3819" rel="noopener" target="_blank">GC优化</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://spring.io/" title="https://spring.io/" rel="noopener" target="_blank">Spring</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://springcloud.cc/" title="https://springcloud.cc/" rel="noopener" target="_blank">SpringCloud</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.ityouknow.com/spring-boot.html" title="http://www.ityouknow.com/spring-boot.html" rel="noopener" target="_blank">纯洁的微笑</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://springboot.fun/" title="http://springboot.fun/" rel="noopener" target="_blank">SpringBoot[中文版]</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://gitee.com/smallc/SpringBlade/tree/2.0-boot" title="https://gitee.com/smallc/SpringBlade/tree/2.0-boot" rel="noopener" target="_blank">SpringBlade</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#概述"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#新特性"><span class="nav-number">2.</span> <span class="nav-text">新特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DBMS"><span class="nav-number">3.</span> <span class="nav-text">DBMS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MVCC"><span class="nav-number">4.</span> <span class="nav-text">MVCC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务隔离级别"><span class="nav-number">5.</span> <span class="nav-text">事务隔离级别</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#事务的基本要素（ACID）"><span class="nav-number">5.1.</span> <span class="nav-text">事务的基本要素（ACID）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#事务的并发问题"><span class="nav-number">5.2.</span> <span class="nav-text">事务的并发问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#事务隔离级别-1"><span class="nav-number">5.3.</span> <span class="nav-text">事务隔离级别</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库锁"><span class="nav-number">6.</span> <span class="nav-text">数据库锁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#乐观锁"><span class="nav-number">6.1.</span> <span class="nav-text">乐观锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#悲观锁"><span class="nav-number">6.2.</span> <span class="nav-text">悲观锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#共享锁（Share-Lock）"><span class="nav-number">6.3.</span> <span class="nav-text">共享锁（Share Lock）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#更新锁（Update-Lock）"><span class="nav-number">6.4.</span> <span class="nav-text">更新锁（Update Lock）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#排他锁（Exclusive-Lock）"><span class="nav-number">6.5.</span> <span class="nav-text">排他锁（Exclusive Lock）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#行锁"><span class="nav-number">6.6.</span> <span class="nav-text">行锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#表锁"><span class="nav-number">6.7.</span> <span class="nav-text">表锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#页锁"><span class="nav-number">6.8.</span> <span class="nav-text">页锁</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL性能"><span class="nav-number">7.</span> <span class="nav-text">MySQL性能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#默认库解读"><span class="nav-number">8.</span> <span class="nav-text">默认库解读</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#体系结构"><span class="nav-number">9.</span> <span class="nav-text">体系结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#存储引擎"><span class="nav-number">10.</span> <span class="nav-text">存储引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#InnoDB"><span class="nav-number">10.1.</span> <span class="nav-text">InnoDB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MyISAM"><span class="nav-number">10.2.</span> <span class="nav-text">MyISAM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Archive"><span class="nav-number">10.3.</span> <span class="nav-text">Archive</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Memory"><span class="nav-number">10.4.</span> <span class="nav-text">Memory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Merge"><span class="nav-number">10.5.</span> <span class="nav-text">Merge</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CSV"><span class="nav-number">10.6.</span> <span class="nav-text">CSV</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BlackHole"><span class="nav-number">10.7.</span> <span class="nav-text">BlackHole</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EXAMPLE"><span class="nav-number">10.8.</span> <span class="nav-text">EXAMPLE</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据预热"><span class="nav-number">11.</span> <span class="nav-text">数据预热</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL调优"><span class="nav-number">12.</span> <span class="nav-text">SQL调优</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL执行顺序"><span class="nav-number">12.1.</span> <span class="nav-text">SQL执行顺序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL优化"><span class="nav-number">12.2.</span> <span class="nav-text">SQL优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Order-By优化"><span class="nav-number">12.3.</span> <span class="nav-text">Order By优化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引命中-amp-失效"><span class="nav-number">13.</span> <span class="nav-text">索引命中&amp;失效</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#聚簇索引"><span class="nav-number">13.1.</span> <span class="nav-text">聚簇索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#非聚簇索引"><span class="nav-number">13.2.</span> <span class="nav-text">非聚簇索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#普通索引"><span class="nav-number">13.3.</span> <span class="nav-text">普通索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#唯一索引"><span class="nav-number">13.4.</span> <span class="nav-text">唯一索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#主键索引"><span class="nav-number">13.5.</span> <span class="nav-text">主键索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BTree索引"><span class="nav-number">13.6.</span> <span class="nav-text">BTree索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-Tree索引"><span class="nav-number">13.7.</span> <span class="nav-text">B+Tree索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#组合索引"><span class="nav-number">13.8.</span> <span class="nav-text">组合索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#全文索引"><span class="nav-number">13.9.</span> <span class="nav-text">全文索引</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主从配置文件"><span class="nav-number">14.</span> <span class="nav-text">主从配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#主库配置"><span class="nav-number">14.1.</span> <span class="nav-text">主库配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#主库配置文件"><span class="nav-number">14.2.</span> <span class="nav-text">主库配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sql-mode"><span class="nav-number">14.3.</span> <span class="nav-text">sql_mode</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#NO-ENGINE-SUBSTITUTION模式"><span class="nav-number">14.3.1.</span> <span class="nav-text">NO_ENGINE_SUBSTITUTION模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#STRICT-TRANS-TABLES模式"><span class="nav-number">14.3.2.</span> <span class="nav-text">STRICT_TRANS_TABLES模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ANSI模式"><span class="nav-number">14.3.3.</span> <span class="nav-text">ANSI模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TRADITIONAL模式"><span class="nav-number">14.3.4.</span> <span class="nav-text">TRADITIONAL模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ONLY-FULL-GROUP-BY模式"><span class="nav-number">14.3.5.</span> <span class="nav-text">ONLY_FULL_GROUP_BY模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#NO-AUTO-VALUE-ON-ZERO模式"><span class="nav-number">14.3.6.</span> <span class="nav-text">NO_AUTO_VALUE_ON_ZERO模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#NO-ZERO-IN-DATE模式"><span class="nav-number">14.3.7.</span> <span class="nav-text">NO_ZERO_IN_DATE模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#NO-AUTO-CREATE-USER模式"><span class="nav-number">14.3.8.</span> <span class="nav-text">NO_AUTO_CREATE_USER模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ANSI-QUOTES模式"><span class="nav-number">14.3.9.</span> <span class="nav-text">ANSI_QUOTES模式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#从库设置"><span class="nav-number">14.4.</span> <span class="nav-text">从库设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#从库配置文件"><span class="nav-number">14.5.</span> <span class="nav-text">从库配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#默认配置参数"><span class="nav-number">14.6.</span> <span class="nav-text">默认配置参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日志"><span class="nav-number">15.</span> <span class="nav-text">日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图"><span class="nav-number">16.</span> <span class="nav-text">视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Explain-amp-Profiling"><span class="nav-number">17.</span> <span class="nav-text">Explain&amp;Profiling</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Explain"><span class="nav-number">17.1.</span> <span class="nav-text">Explain</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Profiling"><span class="nav-number">17.2.</span> <span class="nav-text">Profiling</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考文献"><span class="nav-number">18.</span> <span class="nav-text">参考文献</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        
<div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2019 </span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">志文</span>

  
  


  
  


    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">博客全站共计：</span>
    
    <span title="post.totalcount">48.3k字</span>
  
  
 

</div>
 <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("12/24/2018 12:49:00");
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本博客已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>



        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  



  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>




  
  

  
  <script src="/js/src/scrollspy.js?v=6.6.0"></script>
<script src="/js/src/post-details.js?v=6.6.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  
  
  <script src="//cdn.jsdelivr.net/npm/gitalk@1.4.0/dist/gitalk.min.js"></script>

  
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1.4.0/dist/gitalk.css">

  
  
  <script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script>

   <script>
        var gitalk = new Gitalk({
          clientID: 'fadd19a803bff54d89dc',
          clientSecret: 'd89851454b0e70116a6d0e3bb0ee25729f347afd',
          repo: 'yangzhiwen911.github.io',
          owner: 'yangzhiwen911',
          admin: ['yangzhiwen911'],
          id: md5(location.pathname),
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')
       </script>


  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('复制成功');
          else $(this).text('复制失败');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function () {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


  
  

  
  

  



</body>
</html>
